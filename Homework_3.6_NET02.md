# devops-netology

## HomeWork 3.7
### Желобанов Егор DEVOPS-21

1. Получение списка доступных сетевых интерфейсов:
    * для windows это команда `ipconfig`, для подробного вывода можно использовать параметр `/all`.
    * для linux это команда `ip`, с различными параметрами: `ip a`, `ip -c -br link`, `ip addr` или `ip link show`, покажет список сетевых интерфейсов.
2. Для распознавания соседа по сетевому интерфейсу используется протокол `LLDP`. В Linux для этого существует пакет `lldpd`, команда для вывода информации - `lldpctl`.
3. Для разделения L2 коммутатора на несколько виртуальных сетей используется `VLAN` - виртуальные сети. В Linux существует пакет `vlan`.
   Для определения принадлежности интерфейса к определенному `vlan` необходимо внести изменения в `/etc/network/interface` или начиная с версии Ubuntu 18.* `/etc/netplan/*.yaml`.
   Можно внести записи двух типов: например для принадлежности к `vlan 10` укажем в файле конфигурации `eth0.10` или `vlan10`.
4. Типы агрегации интерфейсов в Linux:
    * **Mode-0(balance-rr)** – данный режим используется по умолчанию. Balance-rr обеспечивает балансировку нагрузки и отказоустойчивость. В данном режиме сетевые пакеты отправляются "по кругу", от первого интерфейса к последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.
    * **Mode-1(active-backup)** – один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.
    * **Mode-2(balance-xor)** – передача пакетов распределяется по типу входящего и исходящего трафика по формуле `((MAC src) XOR (MAC dest)) % число интерфейсов`. Режим дает балансировку нагрузки и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.
    * **Mode-3(broadcast)** – происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.
    * **Mode-4(802.3ad)** – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.
    * **Mode-5(balance-tlb)** – адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.
    * **Mode-6(balance-alb)** – адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

    Пример файла конфигурации:
    ```shell
    auto bond0
    iface bond0 inet static
        bond-slaves wlan0 eth0
        bond-mode active-backup
        bond-primary eth0
        bond-miimon 100
        address <ipv4address>/<maskbits>
        gateway <ipv4address>
    
    allow-bond0 eth0
    iface eth0 inet manual
    
    allow-bond0 wlan0
    iface wlan0 inet manual
    #    bond-give-a-chance 10
        wpa-bridge bond0
        wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf
    ```
5. Все вопросы по ip адресам выполнял с помощью утилиты `ipcalc`.
    * Сколько IP адресов в сети с маской /29? Ответ - 6 адресов:
   ```shell
    vagrant@vagrant:~$ ipcalc 10.0.0.0/29
    Address:   10.0.0.0             00001010.00000000.00000000.00000 000
    Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
    Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
    =>
    Network:   10.0.0.0/29          00001010.00000000.00000000.00000 000
    HostMin:   10.0.0.1             00001010.00000000.00000000.00000 001
    HostMax:   10.0.0.6             00001010.00000000.00000000.00000 110
    Broadcast: 10.0.0.7             00001010.00000000.00000000.00000 111
    Hosts/Net: 6                     Class A, Private Internet
    ```
    * Сколько /29 подсетей можно получить из сети с маской /24? Ответ - 32 подсети (из полного вывода убрал середину, т.к. получится слишком большой список):
   ```shell
    vagrant@vagrant:~$ ipcalc 10.10.10.0/24 /29
    Address:   10.10.10.0           00001010.00001010.00001010. 00000000
    Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
    Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
    =>
    Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
    HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
    HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
    Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
    Hosts/Net: 254                   Class A, Private Internet
    
    Subnets after transition from /24 to /29

    Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
    Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111

   1.
    Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
    HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
    HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
    Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
    Hosts/Net: 6                     Class A, Private Internet

   2.
    Network:   10.10.10.8/29        00001010.00001010.00001010.00001 000
    HostMin:   10.10.10.9           00001010.00001010.00001010.00001 001
    HostMax:   10.10.10.14          00001010.00001010.00001010.00001 110
    Broadcast: 10.10.10.15          00001010.00001010.00001010.00001 111
    Hosts/Net: 6                     Class A, Private Internet

   ...

   31.
    Network:   10.10.10.240/29      00001010.00001010.00001010.11110 000
    HostMin:   10.10.10.241         00001010.00001010.00001010.11110 001
    HostMax:   10.10.10.246         00001010.00001010.00001010.11110 110
    Broadcast: 10.10.10.247         00001010.00001010.00001010.11110 111
    Hosts/Net: 6                     Class A, Private Internet

   32.
    Network:   10.10.10.248/29      00001010.00001010.00001010.11111 000
    HostMin:   10.10.10.249         00001010.00001010.00001010.11111 001
    HostMax:   10.10.10.254         00001010.00001010.00001010.11111 110
    Broadcast: 10.10.10.255         00001010.00001010.00001010.11111 111
    Hosts/Net: 6                     Class A, Private Internet
    
    
    Subnets:   32
    Hosts:     192
    ```
    * Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24? Ответ - примеры сетей можно увидеть пунктом выше.
6. Для решения нашей задачи допустимо взять частные ip-адреса из подсети `100.64.0.0/10` (используется как транслируемый блок адресов для межпровайдерских взаимодействий и Carrier Grade NAT). В нашем случае подойдет подсеть `100.64.0.0/26` - 62 доступных хоста, т.к. в подсети `/25` - 126 хоста, что явно много, а в подсети `/27` - 30 хостов, что недостаточно для нашей задачи.
    ```shell
    vagrant@vagrant:~$ ipcalc 100.64.0.0/26
    Address:   100.64.0.0           01100100.01000000.00000000.00 000000
    Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
    Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
    =>
    Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
    HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
    HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
    Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
    Hosts/Net: 62                    Class A
    ```
7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP? Все это можно сделать следующими способами:  
   Для Windows:
    * просмотр ARP таблицы - `arp -a`
    * очистка ARP кеша - `arp -d`
    * удаление только одного IP из ARP таблицы - `arp -d <указать_ip_адрес>`, например `arp -d 10.0.2.2`  
   
   Для Linux: 
    * просмотр ARP таблицы - `ip neigh`
    * очистка ARP кеша - `sudo ip neigh flush all`
    * удаление только одного IP из ARP таблицы - `ip neigh del <указать_ip_адрес> dev <указать_интерфейс>`, например `sudo ip neigh del 10.0.2.2 dev eth0`
