# devops-netology

### Желобанов Егор DEVOPS-21

# Домашнее задание к занятию 12.10 «Helm»

### Цель задания

В тестовой среде Kubernetes необходимо установить и обновить приложения с помощью Helm.

------

### Чеклист готовности к домашнему заданию

1. Установленное k8s-решение, например, MicroK8S.
2. Установленный локальный kubectl.
3. Установленный локальный Helm.
4. Редактор YAML-файлов с подключенным репозиторием GitHub.

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Инструкция](https://helm.sh/docs/intro/install/) по установке Helm. [Helm completion](https://helm.sh/docs/helm/helm_completion/).

------

### Задание 1. Подготовить Helm-чарт для приложения

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения. 
2. Каждый компонент приложения деплоится отдельным deployment’ом или statefulset’ом.
3. В переменных чарта измените образ приложения для изменения версии.

### Ответ:

1. Упаковал приложение командой `helm create nginx`:  
    ![](/pics/12.10/helm_create_nginx.jpg)  
2. Так как базово создалось достаточно много файлов и куча переменных, для упрощения задания отредактировал [конфигурационные файлы приложения](/practice/12.10/nginx).
3. В [файле переменных чарта](/practice/12.10/nginx/values.yaml) внес необходимые изменения.

------
### Задание 2. Запустить две версии в разных неймспейсах

1. Подготовив чарт, необходимо его проверить. Запуститe несколько копий приложения.
2. Одну версию в namespace=app1, вторую версию в том же неймспейсе, третью версию в namespace=app2.
3. Продемонстрируйте результат.

### Ответ:
1. Запустил несколько копий приложения.
2. Версии запущенного приложения:
    * одна версия в `namespace=app1`, `nginx=1.16.0`, `app-name=netology-nginx`
    * вторая в namespace=app1 но версия `nginx=1.19.0`, `app-name=netology-nginx2`
    * третья версия в `namespace=app2`, `nginx=1.19.0`, `app-name=netology-nginx2`  
    ![](/pics/12.10/all-deployments.jpg)  
3. Смотрим версии запущенных приложений:  
    * заходим в первый контейнер командой `kubectl --namespace=app1 exec -it netology-nginx-7d994bd696-d2477 sh`:  
    ![](/pics/12.10/app1.jpg)  
    * заходим во второй контейнер в этом же namespace командой `kubectl --namespace=app1 exec -it netology-nginx2-c5c6486fc-fk4j4 sh`:  
    ![](/pics/12.10/app2.jpg)  
    * и наконец заходим в третий контейнер, который работает в namespace app2 командой `kubectl --namespace=app2 exec -it netology-nginx2-56d757c474-dl9ll sh`:  
    ![](/pics/12.10/app3.jpg)
4. На этом данное задание считаю выполненным.

### Правила приёма работы

1. Домашняя работа оформляется в своём Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд `kubectl`, `helm`, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.

